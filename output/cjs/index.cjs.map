{"version":3,"sources":["../../src/bin.ts","../../src/index.cts"],"sourcesContent":["import chalk from \"chalk\";\r\nimport inquirer from \"inquirer\";\r\nimport { PrismaHighlighter } from \"prismalux\";\r\nimport boxen from \"boxen\";\r\nimport { mutationsHandler, prismaQlParser, PrismaQlProvider, PrismaQlRelationCollector, PrismaQlSchemaLoader, queryRendersHandler } from \"prismaql\";\r\nconst manager = new PrismaQlSchemaLoader(new PrismaQlRelationCollector());\r\nconst highlightPrismaSchema = new PrismaHighlighter();\r\n\r\nconst confirm = async (msg: string) => {\r\n    console.log(boxen(\r\n        highlightPrismaSchema.highlight(msg),\r\n        { padding: 1, margin: 1, borderStyle: \"double\" }\r\n    ));\r\n\r\n    console.log(chalk.greenBright(\"ðŸŽ‰ðŸŽ‰ðŸŽ‰ Mutation is valid and can be applied.\\n\"));\r\n    const { confirm } = await inquirer.prompt({\r\n        type: \"confirm\",\r\n        name: \"confirm\",\r\n        message: chalk.yellowBright(\"Do you want to overwrite the Prisma file with these changes?\"),\r\n    });\r\n    return confirm;\r\n}\r\n\r\nconst loadQueryRenderManager = async (options: Record<string, boolean | string | number> = {}) => {\r\n    await manager.loadFromFile();\r\n    const provider = new PrismaQlProvider({\r\n        queryHandler: queryRendersHandler,\r\n        mutationHandler: mutationsHandler,\r\n        loader: manager,\r\n    })\r\n    return (sourceCommand: string) => {\r\n        if (sourceCommand?.split(';').length > 2) {\r\n            return provider.multiApply(sourceCommand, {\r\n                save: true,\r\n                dryRun: options.dry as boolean,\r\n                confirm: confirm\r\n            }).then(res => {\r\n                res.forEach((r, i) => {\r\n                    if (r?.result) {\r\n                        console.log(chalk.greenBright(`Command ${i + 1} result: \\n${r.result}`));\r\n                    } else {\r\n                        console.error(`Command ${i + 1} error: ${r.error}`);\r\n                    }\r\n                });\r\n                console.log(chalk.greenBright(\"\\nAll commands applied\"));\r\n            }).catch(e => {\r\n                console.error(`Error: ${e.message}`);\r\n            });\r\n        }\r\n        const isValid = prismaQlParser.isValid(sourceCommand);\r\n        if (isValid instanceof Error) {\r\n            console.log(chalk.redBright(`Invalid command: ${isValid.message}`));\r\n            console.log(chalk.yellowBright(\"Example command pattern: ACTION COMMAND ...args (options) ({prismaBlock})\"));\r\n            return;\r\n        } else {\r\n            console.log(chalk.greenBright(\"Command is valid\"));\r\n        }\r\n        provider.apply(sourceCommand, {\r\n            save: true,\r\n            dryRun: options.dry as boolean,\r\n            confirm: confirm\r\n        }).then(res => {\r\n            if (res?.response?.result) {\r\n                console.log(chalk.greenBright(res.response.result));\r\n            } else {\r\n                console.error(`Error: ${res.response.error}`);\r\n            }\r\n        }).catch(e => {\r\n            console.log(chalk.redBright(`Error: ${e.message}`));\r\n        });\r\n    }\r\n}\r\nexport default loadQueryRenderManager;","#!/usr/bin/env node\r\nconst loadQueryRenderManager = require('./bin.js');\r\nconst { readFileSync } = require('fs');\r\nconst { resolve } = require('path');\r\n\r\nconst { version } = JSON.parse(readFileSync(resolve(process.cwd(), 'package.json'), 'utf-8'));\r\n\r\nfunction showHelp() {\r\n  console.log(`\r\nUsage: prismaql <command> [--dry]\r\n\r\nOptions:\r\n  --dry    Perform a dry run without applying changes\r\n  --help   Show this help message\r\n  --version  Show the CLI version\r\n\r\nExamples:\r\n  prismaql \"GET MODEL User;\"\r\n  prismaql \"ADD FIELD name ({String});\" --dry\r\n`);\r\n}\r\n\r\nasync function main() {\r\n  const args = process.argv.slice(2);\r\n  if (args.length === 0 || args.includes('--help')) {\r\n    showHelp();\r\n    process.exit(0);\r\n  }\r\n\r\n  if (args.includes('--version')) {\r\n    console.log(`PrismaQL CLI v${version}`);\r\n    process.exit(0);\r\n  }\r\n\r\n  const command = args.find(arg => !arg.startsWith('--'));\r\n  if (!command) {\r\n    console.error(\"Error: Missing command. Use --help for usage information.\");\r\n    process.exit(1);\r\n  }\r\n\r\n  const options = {\r\n    dry: args.includes('--dry')\r\n  };\r\n\r\n  try {\r\n    const queryManager = await loadQueryRenderManager(options);\r\n    await queryManager(command);\r\n  } catch (error) {\r\n    console.error(\"Error parsing command:\", error.message);\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\nmain();\r\n"],"mappings":"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","names":["boxen","chalk","confirm","inquirer","loadQueryRenderManager"]}